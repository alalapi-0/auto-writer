<!DOCTYPE html> <!-- 运行列表页面 -->
<html lang="zh"> <!-- 中文 -->
<head>
  <meta charset="utf-8" />
  <title>运行记录</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <main>
    <h1>运行记录</h1>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Profile</th>
          <th>状态</th>
          <th>开始时间</th>
          <th>结束时间</th>
          <th>生成数</th>
          <th>成功</th>
          <th>失败</th>
          <th>错误</th>
        </tr>
      </thead>
      <tbody id="run-body">
        <tr><td colspan="9">加载中...</td></tr>
      </tbody>
    </table>
  </main>
  <script>
  async function loadRuns() {
    const token = localStorage.getItem('jwt');
    if (!token) {
      document.getElementById('run-body').innerHTML = '<tr><td colspan="9">请先登录</td></tr>';
      return;
    }
    const resp = await fetch('/api/runs?limit=50', { headers: { Authorization: `Bearer ${token}` } });
    if (!resp.ok) {
      document.getElementById('run-body').innerHTML = '<tr><td colspan="9">加载失败</td></tr>';
      return;
    }
    const data = await resp.json();
    document.getElementById('run-body').innerHTML = data.items.map((row) => `
      <tr>
        <td>${row.id}</td>
        <td>${row.profile_id}</td>
        <td>${row.status}</td>
        <td>${row.started_at}</td>
        <td>${row.finished_at ?? ''}</td>
        <td>${row.emitted}</td>
        <td>${row.success}</td>
        <td>${row.failed}</td>
        <td>${row.error ?? ''}</td>
      </tr>
    `).join('');
  }
  loadRuns();
  </script>
</body>
</html>
