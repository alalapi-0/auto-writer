# 运维手册与 SLO 指南

## 服务级目标（SLO）
- 成功率目标：所有生成+投递流程每日成功率需达到 98% 以上。
- 时延目标：自任务领取到完成投递的 P95 时延不超过 8 分钟。
- 死信率：每日死信占比保持在 1% 以下，超过阈值需启动复盘。

## 常见告警排障 Runbook
- DashboardDown：首先确认仪表盘进程与监听端口，其次检查反向代理健康；仍未恢复时查看日志 `logs/dashboard.log`。
- QueueBacklogHigh：在 Prometheus/任务队列页面核对 backlog；根据 Worker 心跳判断是否扩容；必要时暂停新任务。
- DeliveryFailureRate：查看 `platform_logs` 最近 30 分钟错误；若集中在单一平台，临时禁用该平台并通知运营；同步比对 Chaos 指标排除演练影响。

## 容量与并发估算
- 假设单个 Worker 并发处理能力为 N（条/分钟），每日可处理约 `N * 60 * 24 * 利用率` 条任务。
- 预估新增平台时，将其限速参数代入，校验峰值是否超出 Worker 并发能力。
- 保持至少 30% 峰值冗余，确保临时演练或回放时不触发排队。

## 变更管理流程
- Prompt 权重调整：先在预发环境启用 CHAOS_ENABLE 验证稳定性，再以 10% 流量灰度，两小时无异常后再全量。
- 阈值变更：记录变更单与预期影响，设置观察窗口并在 Prometheus 中新增对比面板。
- 任何影响生成/投递链路的配置需在群内提前 24 小时告知相关干系人。

## 安全要点
- 所有密钥仅以只读环境变量注入，严禁写入仓库或日志。
- 浏览器 Cookie、LocalStorage 必须通过 Fernet 加密存储，禁止明文落盘。
- 敏感调试接口仅允许本机或内网访问，外部访问需通过 VPN 与多因子认证。
